(function(){if(void 0!==window.flagrate)throw Error("[conflict] flagrate is already defined.");var e=window.flagrate={};e.className="flagrate";var T=e.identity=function(a){return a},n=e.extendObject=function(a,b){for(var c in b)a[c]=b[c];return a},t=e.emptyFunction=function(){},x;x="object"===typeof window.HTMLElement?function(a){return a instanceof window.HTMLElement}:function(a){return a&&"object"===typeof a&&null!==a&&1===a.nodeType&&"string"===typeof a.nodeName};var u=e.jsonPointer={untilde:function(a){return a.replace(/~[01]/g,
function(a){switch(a){case "~0":return"~";case "~1":return"/"}throw Error("Invalid tilde escape: "+a);})},traverse:function(a,b,c,d){var h=u.untilde(b.shift());/^\d+$/.test(h)&&(h=parseInt(h,10));if(0!==b.length){if(d&&"object"!==typeof a[h]){if(void 0===c)return c;/^\d+$/.test(b[0])?a[h]=[]:a[h]={}}return u.traverse(a[h],b,c,d)}if(!d)return a[h];void 0===c?delete a[h]:a[h]=c;return c},validate_input:function(a,b){if("object"!==typeof a)throw Error("Invalid input object.");if(""===b)return[];if(!b)throw Error("Invalid JSON pointer.");
b=b.split("/");if(""!==b.shift())throw Error("Invalid JSON pointer.");return b},get:function(a,b){b=u.validate_input(a,b);return 0===b.length?a:u.traverse(a,b)},set:function(a,b,c){if(""===b&&"object"===typeof c)return e.extendObject(a,c),c;b=u.validate_input(a,b);if(0===b.length)throw Error("Invalid JSON pointer for set.");return u.traverse(a,b,c,!0)}},f=e.Element=function(a,b){b=b||null;a=(a||"div").toLowerCase();var c;f.cache[a]?c=f.cache[a].cloneNode(!1):null!==b&&b.hasOwnProperty("type")||"select"===
a?c=document.createElement(a):(c=document.createElement(a),f.cache[a]=c.cloneNode(!1));n(c,this);return null===b?c:f.writeAttribute(c,b)};e.createElement=function(a,b){return new f(a,b)};f.cache={};f.prototype={isFlagrated:!0,visible:function(){return f.visible(this)},exists:function(){return f.exists(this)},toggle:function(){return f.toggle(this)},hide:function(){return f.hide(this)},show:function(){return f.show(this)},remove:function(){return f.remove(this)},update:function(a){return f.update(this,
a)},updateText:function(a){return f.updateText(this,a)},insert:function(a){return f.insert(this,a)},insertText:function(a){return f.insertText(this,a)},insertTo:function(a,b){return f.insertTo(this,a,b)},readAttribute:function(a){return f.readAttribute(this,a)},writeAttribute:function(a,b){return f.writeAttribute(this,a,b)},getDimensions:function(){return f.getDimensions(this)},getHeight:function(){return f.getHeight(this)},getWidth:function(){return f.getWidth(this)},cumulativeOffset:function(){return f.cumulativeOffset(this)},
cumulativeScrollOffset:function(){return f.cumulativeScrollOffset(this)},hasClassName:function(a){return f.hasClassName(this,a)},addClassName:function(a){return f.addClassName(this,a)},removeClassName:function(a){return f.removeClassName(this,a)},toggleClassName:function(a){return f.toggleClassName(this,a)},getStyle:function(a){return f.getStyle(this,a)},setStyle:function(a){return f.setStyle(this,a)},on:function(a,b,c){return f.on(this,a,b,c)},off:function(a,b,c){return f.off(this,a,b,c)},fire:function(a,
b){return f.fire(this,a,b)}};f.prototype.emit=f.prototype.fire;f.visible=function(a){return"none"!==a.style.display};f.exists=function(a){if(a.parentNode)for(;null!==(a=a.parentNode);)if(a===document)return!0;return!1};f.toggle=function(a){return f[f.visible(a)?"hide":"show"](a)};f.hide=function(a){a.style.display="none";return a};f.show=function(a){a.style.display="";return a};f.remove=function(a){a.parentNode&&a.parentNode.removeChild(a);return a};f.update=function(a,b){for(var c=a.childNodes.length;c--;)e.Element.remove(a.childNodes[c]);
if(!b)return a;if(!0===x(b))return a.appendChild(b),a;"string"!==typeof b&&(b=b.toString(10));a.innerHTML=b;return a};f.updateText=function(a,b){for(var c=a.childNodes.length;c--;)e.Element.remove(a.childNodes[c]);if(!b)return a;if(!0===x(b)&&void 0!==b.toString)return f.updateText(a,b.toString());"string"!==typeof b&&(b=b.toString(10));a.appendChild(document.createTextNode(b));return a};f.insert=function(a,b){if("string"===typeof b||"number"===typeof b||!0===x(b))b={bottom:b};var c,d,h,e;for(c in b)if(b.hasOwnProperty(c))if(d=
b[c],c=c.toLowerCase(),h=f._insertionTranslation[c],!0===x(d))h(a,d);else for("string"!==typeof d&&(d=d.toString(10)),e=new f,e.innerHTML=d,"top"!==c&&"after"!==c||e.childNodes.reverse();0!==e.childNodes.length;)h(a,e.childNodes[0]);return a};f.insertText=function(a,b){if("string"===typeof b||"number"===typeof b)b={bottom:b};var c,d,h;for(c in b)b.hasOwnProperty(c)&&(d=b[c],c=c.toLowerCase(),h=f._insertionTranslation[c],"string"!==typeof d&&(d=d.toString(10)),h(a,document.createTextNode(d)));return a};
f.insertTo=function(a,b,c){var d={};c?d[c]=a:d.bottom=a;f.insert(b,d);return a};f.wrap=function(a,b,c){!0===x(b)?c&&f.writeAttribute(b,c):b="string"===typeof b?new f(b,c):new f("div",b);a.parentNode&&a.parentNode.replaceChild(b,a);b.appendChild(a);return b};f.readAttribute=function(a,b){return a.getAttribute(b)};f.writeAttribute=function(a,b,c){var d={};"object"===typeof b?d=b:d[b]=void 0===c?!0:c;for(var h in d)d.hasOwnProperty(h)&&(c=d[h],!1===c||null===c?a.removeAttribute(h):!0===c?a.setAttribute(h,
h):void 0!==c&&a.setAttribute(h,c));return a};f.getDimensions=function(a){var b=f.getStyle(a,"display");if(b&&"none"!==b)return{width:a.offsetWidth,height:a.offsetHeight};var b={visibility:a.style.visibility,position:a.style.position,display:a.style.display},c={visibility:"hidden",display:"block"};"fixed"!==b.position&&(c.position="absolute");f.setStyle(a,c);c={width:a.offsetWidth,height:a.offsetHeight};f.setStyle(a,b);return c};f.getHeight=function(a){return f.getDimensions(a).height};f.getWidth=
function(a){return f.getDimensions(a).width};f.cumulativeOffset=function(a){var b=0,c=0;if(a.parentNode){do b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;while(a)}return{top:b,left:c}};f.cumulativeScrollOffset=function(a){var b=0,c=0;do b+=a.scrollTop||0,c+=a.scrollLeft||0,a=a.parentNode===document.body&&0!==document.documentElement.scrollTop?document.documentElement:a.parentNode;while(a);return{top:b,left:c}};f.hasClassName=function(a,b){return 0<a.className.length&&(a.className===b||(new RegExp("(^|\\s)"+
b+"(\\s|$)")).test(a.className))};f.addClassName=function(a,b){f.hasClassName(a,b)||(a.className+=(a.className?" ":"")+b);return a};f.removeClassName=function(a,b){a.className=a.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," ").trim();return a};f.toggleClassName=function(a,b){return f[f.hasClassName(a,b)?"removeClassName":"addClassName"](a,b)};f.getStyle=function(a,b){b="float"===b?"cssFloat":b.replace(/-+([a-z])?/g,function(a,b){return b?b.toUpperCase():""});var c=a.style[b];c&&"auto"!==
c||(c=(c=document.defaultView.getComputedStyle(a,null))&&void 0!==c[b]&&""!==c[b]?c[b]:null);return"opacity"===b?c?parseFloat(c):1:"auto"===c?null:c};f.setStyle=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a.style["float"===c||"cssFloat"===c?void 0===a.style.styleFloat?"cssFloat":"styleFloat":c]=b[c]);return a};f.on=function(a,b,c,d){a.addEventListener(b,c,d||!1);return a};f.off=function(a,b,c,d){a.removeEventListener(b,c,d||!1);return a};f.fire=function(a,b,c){var d=document.createEvent("HTMLEvents");
d.initEvent(b,!0,!0);c&&n(d,c);a.dispatchEvent(d);return a};f.emit=f.fire;f.extend=function(a){if(a.isFlagrated)return a;n(a,f.prototype);return a};f._insertionTranslation={before:function(a,b){a.parentNode.insertBefore(b,a)},top:function(a,b){a.insertBefore(b,a.firstChild)},bottom:function(a,b){a.appendChild(b)},after:function(a,b){a.parentNode.insertBefore(b,a.nextSibling)}};var q=e.Button=function(a){a=a||{};a.label=a.label||"";a.isRemovableByUser=a.isRemovableByUser||!1;this.onSelect=a.onSelect||
t;this.onRemove=a.onRemove||t;var b=a.attribute||{};a.id&&(b.id=a.id);a.isFocused&&(b.autofocus=!0);b.type||(b.type="button");b=new f("button",b);n(b,this);b._label=(new f("span")).updateText(a.label).insertTo(b);b.addClassName(e.className+" "+e.className+"-button");a.className&&b.addClassName(a.className);b.on("click",b._onSelectHandler.bind(b),!0);a.isRemovableByUser&&(b.addClassName(e.className+"-button-removable"),b._removeButton=(new f("button",{type:"button","class":e.className+"-button-remove"})).insertTo(b),
b._removeButton.on("click",b._onRemoveHandler.bind(b),!0));a.style&&b.setStyle(a.style);a.color&&b.setColor(a.color);a.icon&&b.setIcon(a.icon);a.isDisabled&&b.disable();return b};e.createButton=function(a){return new q(a)};q.prototype={select:function(){return this._onSelectHandler(null)},disable:function(){this.addClassName(e.className+"-disabled");this.writeAttribute("disabled",!0);return this},enable:function(){this.removeClassName(e.className+"-disabled");this.writeAttribute("disabled",!1);return this},
isEnabled:function(){return!this.hasClassName(e.className+"-disabled")},setLabel:function(a){this._label.updateText(a);return this},setColor:function(a){"@"===a.charAt(0)?(this.style.backgroundColor="",this.addClassName(e.className+"-button-color-"+a.slice(1))):this.style.backgroundColor=a;return this},setIcon:function(a){return a?this.addClassName(e.className+"-icon").setStyle({backgroundImage:"url("+a+")"}):this.removeClassName(e.className+"-icon").setStyle({backgroundImage:"none"})},_onSelectHandler:function(a){if(!1!==
this.isEnabled()){if(this._removeButton&&a&&a.layerX){var b=this.getWidth(),c=this.getHeight(),d=null===this._removeButton.getStyle("margin-right")?0:parseInt(this._removeButton.getStyle("margin-right").replace("px",""),10),h=this._removeButton.getWidth(),e=this._removeButton.getHeight(),f=a.layerX,l=a.layerY;if(f>b-d-h&&f<b-d&&l>c-(c-e)/2-e&&l<c-(c-e)/2)return this._onRemoveHandler(a),this}a.targetButton=this;this.onSelect(a,this);this.fire("select",{targetButton:this})}},_onRemoveHandler:function(a){if(this.isEnabled()&&
this.remove())this.onRemove(a)}};var B=e.Buttons=function(a){a=a||{};a.items=a.items||[];this.onSelect=a.onSelect||t;var b=a.attribute||{};b.id=a.id;b["class"]=a.className;b=new f("div",b);n(b,this);b.addClassName(e.className+" "+e.className+"-buttons");var c,d;c=0;for(d=a.items.length;c<d;c++)b.push(a.items[c]);b.on("click",function(a){a.stopPropagation();a.preventDefault()});return b};e.createButtons=function(a){return new B(a)};B.prototype={push:function(a){var b=(new q({icon:a.icon,label:a.label,
isDisabled:a.isDisabled,color:a.color,onSelect:function(b){if(a.onSelect)a.onSelect(b);this.onSelect(b)}.bind(this)})).insertTo(this);a.key&&(b._key=a.key);return this},getButtonByKey:function(a){var b=null,c=this.childNodes,d,h;d=0;for(h=c.length;d<h;d++)if(c[d]._key&&c[d]._key===a){b=c[d];break}return b},getButtons:function(){return this.childNodes||[]}};var y=e.Menu=function(a){a=a||{};a.items=a.items||[];this.onSelect=a.onSelect||t;var b=a.attribute||{};a.id&&(b.id=a.id);b=new f("div",b);n(b,
this);b.addClassName(e.className+" "+e.className+"-menu");a.className&&b.addClassName(a.className);var c,d;c=0;for(d=a.items.length;c<d;c++)b.push(a.items[c]);b.on("click",function(a){a.stopPropagation();a.preventDefault()});b.on("mouseup",function(a){a.stopPropagation()});return b};e.createMenu=function(a){return new y(a)};y.prototype={push:function(a){if("string"===typeof a)(new f("hr")).insertTo(this);else{var b=(new q({icon:a.icon,label:a.label,isDisabled:a.isDisabled,onSelect:function(b){if(a.onSelect)a.onSelect(b);
this.onSelect(b)}.bind(this)})).insertTo(this);a.key&&(b._key=a.key)}return this},getButtonByKey:B.prototype.getButtonByKey,getButtons:B.prototype.getButtons};var M=e.Pulldown=function(a){a=a||{};a.label=a.label||"";a.items=a.items||null;a.onSelect=a.onSelect||t;var b=a.attribute||{};a.id&&(b.id=a.id);var c=new q({attribute:b,label:a.label,icon:a.icon});n(c,this);c.addClassName(e.className+"-pulldown");a.className&&c.addClassName(a.className);c.onSelect=function(b){if(c._menu)c._menu.remove(),delete c._menu;
else{var h=c._menu=(new f("div",{"class":e.className+"-pulldown-menu"})).insert(new y({items:a.items,onSelect:function(){a.onSelect();h.remove();delete c._menu}}));h.style.top=c.offsetTop+c.getHeight()+"px";h.style.left=c.offsetLeft+"px";c.insert({after:h});b=h.getHeight();var k=parseInt(h.getStyle("margin-top").replace("px",""),10),m=c.cumulativeOffset().top,l=-window.pageYOffset+m,m=window.pageYOffset+window.innerHeight-m-c.getHeight();b+k>m&&(l>m?(l<b+k&&(b=l-k-k,h.style.maxHeight=b+"px"),h.style.top=
c.offsetTop-b-2*k+"px"):h.style.maxHeight=m-k-k+"px");var r=function(a){document.body.removeEventListener("click",r);c.parentNode&&c.parentNode.removeEventListener("click",r);c.off("click",r);h.style.opacity="0";setTimeout(function(){h.remove()}.bind(this),500);delete c._menu};setTimeout(function(){document.body.addEventListener("click",r);c.parentNode.addEventListener("click",r);c.on("click",r)},0)}};(new f("span",{"class":e.className+"-pulldown-triangle"})).insertTo(c);a.style&&c.setStyle(a.style);
a.color&&c.setColor(a.color);a.isDisabled&&c.disable();return c};e.createPulldown=function(a){return new M(a)};var E=e.ContextMenu=function(a){a=a||{};this.target=a.target||null;this.items=a.items||null;this.isShowing=!1;this.open=function(a){a=a||window.event||{};a.preventDefault&&a.preventDefault();this.isShowing&&this.close();this.isShowing=!0;this._menu=new y({className:e.className+"-context-menu",items:this.items,onSelect:this.close.bind(this)});var c=a.clientX||0;a=a.clientY||0;this._menu.style.opacity=
0;this._menu.insertTo(document.body);c+this._menu.getWidth()>window.innerWidth&&(c-=this._menu.getWidth());a+this._menu.getHeight()>window.innerHeight&&(a-=this._menu.getHeight());this._menu.style.top=a+"px";this._menu.style.left=c+"px";this._menu.style.opacity=1;document.body.addEventListener("click",this.close);document.body.addEventListener("mouseup",this.close);document.body.addEventListener("mousewheel",this.close);return this}.bind(this);this.close=function(){document.body.removeEventListener("click",
this.close);document.body.removeEventListener("mouseup",this.close);document.body.removeEventListener("mousewheel",this.close);this.isShowing=!1;var a=this._menu;setTimeout(function(){a&&a.remove&&a.remove()},0);delete this._menu;return this}.bind(this);null!==this.target&&this.target.addEventListener("contextmenu",this.open);return this};e.createContextMenu=function(a){return new E(a)};E.prototype={visible:function(){return this.isShowing},remove:function(){this._menu&&this.close();null!==this.target&&
this.target.removeEventListener("contextmenu",this.open)}};var F=e.Toolbar=function(a){a=a||{};a.items=a.items||[];var b=a.attribute||{};b.id=a.id;b["class"]=a.className;b=new f("div",b);n(b,this);b.addClassName(e.className+" "+e.className+"-toolbar");var c,d;c=0;for(d=a.items.length;c<d;c++)b.push(a.items[c]);a.style&&b.setStyle(a.style);return b};e.createToolbar=function(a){return new F(a)};F.prototype={push:function(a){"string"===typeof a?(new f("hr")).insertTo(this):a instanceof HTMLElement?this.insert(a):
a.element&&(a.key&&(a.element._key=a.key),this.insert(a.element));return this},getElementByKey:function(a){var b=null,c=this.childNodes,d,h;d=0;for(h=c.length;d<h;d++)if(c[d]._key&&c[d]._key===a){b=c[d];break}return b}};var w=e.TextInput=function(a){a=a||{};this.regexp=a.regexp||null;var b=a.attribute||{};b.id=a.id||null;b["class"]=a.className||null;b.value=a.value||null;b.placeholder=a.placeholder||null;b=new f("input",b);n(b,this);b.addClassName(e.className+" "+e.className+"-textinput");a.icon&&
(b.addClassName(e.className+"-icon"),b.setStyle({backgroundImage:"url("+a.icon+")"}));a.style&&b.setStyle(a.style);a.isDisabled&&b.disable();return b};e.createTextInput=function(a){return new w(a)};w.prototype={disable:function(){this.addClassName(e.className+"-disabled");this.writeAttribute("disabled",!0);return this},enable:function(){this.removeClassName(e.className+"-disabled");this.writeAttribute("disabled",!1);return this},isEnabled:function(){return!this.hasClassName(e.className+"-disabled")},
getValue:function(){return this.value},setValue:function(a){this.value=a;return this},isValid:function(){return this.regexp.test(this.getValue())}};var N=e.Tokenizer=function(a){a=a||{};a.placeholder=a.placeholder||null;this.values=a.values||[];this.max=a.max||-1;this.tokenize=a.tokenize||T;this.onChange=a.onChange||t;var b=a.attribute||{};b.id=a.id||null;b["class"]=a.className||null;b=new f("div",b);n(b,this);b.addClassName(e.className+" "+e.className+"-tokenizer");a.icon&&(b.addClassName(e.className+
"-icon"),b.setStyle({backgroundImage:"url("+a.icon+")"}));b._tokens=(new f("span")).insertTo(b);b._input=(new w({placeholder:a.placeholder})).insertTo(b);0!==b.values.length&&b._updateTokens();b.on("click",b._onClickHandler.bind(b));b._input.on("keydown",b._onKeydownHandler.bind(b));b._input.on("focus",b._onFocusHandler.bind(b));b._input.on("blur",b._onBlurHandler.bind(b));a.style&&b.setStyle(a.style);a.isDisabled&&b.disable();return b};e.createTokenizer=function(a){return new N(a)};N.prototype={disable:function(){this.addClassName(e.className+
"-disabled");this._input.disable();return this._updateTokens()},enable:function(){this.removeClassName(e.className+"-disabled");this._input.enable();return this._updateTokens()},isEnabled:function(){return!this.hasClassName(e.className+"-disabled")},getValues:function(){return this.values},setValues:function(a){this.values=a;return this._updateTokens()},removeValues:function(){this.values=[];return this._updateTokens()},removeValue:function(a){this.values.splice(this.values.indexOf(a),1);return this._updateTokens()},
_updateTokens:function(){this._tokens.update();var a,b;a=0;for(b=this.values.length;a<b;a++){var c=this.values[a],d="",d="string"===typeof c?c:c.label;(new q({isDisabled:!1===this.isEnabled(),isRemovableByUser:this.isEnabled(),onRemove:this._createTokenButtonOnRemoveHandler(this,c),label:d})).insertTo(this._tokens)}a=this.getWidth();b=null===this.getStyle("border-width")?2:parseInt(this.getStyle("border-width").replace("px",""),10);var c=null===this.getStyle("padding-left")?4:parseInt(this.getStyle("padding-left").replace("px",
""),10),d=null===this.getStyle("padding-right")?4:parseInt(this.getStyle("padding-right").replace("px",""),10),h=this._tokens.getWidth(),e=null===this._tokens.getStyle("margin-left")?2:parseInt(this._tokens.getStyle("margin-left").replace("px",""),10),f=null===this._input.getStyle("margin-left")?2:parseInt(this._input.getStyle("margin-left").replace("px",""),10),l=null===this._input.getStyle("padding-left")?2:parseInt(this._input.getStyle("padding-left").replace("px",""),10);a=a-c-d-h-e-f-l-2*b-2;
this._input.style.width=30<a?a+"px":-5>a?"":"100%";this.fire("change");return this},_createTokenButtonOnRemoveHandler:function(a,b){return function(){a.removeValue(b)}},_tokenize:function(a){this._candidates=[];a=this.tokenize(this._input.value,this._tokenized.bind(this));void 0!==a&&this._tokenized(a);this._lastTokenizedValue=this._input.value;return this},_tokenized:function(a){!1===a instanceof Array&&(a=[a]);this._candidates=[];var b=new y({onSelect:function(){b.remove()}});b.style.left=this._input.offsetLeft+
"px";var c,d;c=0;for(d=a.length;c<d;c++){var h=a[c],e;if("string"===typeof h){if(""===h)continue;e={label:h}}else e=h;e.onSelect&&(e._onSelect=e.onSelect);e.onSelect=this._createMenuOnSelectHandler(this,h,e);this._candidates.push(h);b.push(e)}this._menu&&this._menu.remove();0!==this._candidates.length&&(this.insert({top:b}),this._menu=b);return this},_createMenuOnSelectHandler:function(a,b,c){return function(d){(0>a.max||a.max>a.values.length)&&a.values.push(b);a._updateTokens();a.onChange();c._onSelect&&
c._onSelect(d)}},_onClickHandler:function(a){this._input.focus()},_onKeydownHandler:function(a){13===a.keyCode&&this._lastTokenizedValue!==this._input.value?(a.stopPropagation(),a.preventDefault(),this._lastTokenizedValue=this._input.value,this._tokenize()):(!this._candidates||0===this._candidates.length||13!==a.keyCode&&39!==a.keyCode||(a.stopPropagation(),a.preventDefault(),this._input.value="",(0>this.max||this.max>this.values.length)&&this.values.push(this._candidates[0]),this._updateTokens(),
this.onChange(),this._menu&&this._menu.remove()),""===this._input.value&&0!==this.values.length&&8===a.keyCode&&(a.stopPropagation(),a.preventDefault(),this._input.value=this.values.pop(),this._updateTokens(),this.onChange(),this._menu&&this._menu.remove()),setTimeout(function(){-1<this.max&&this.max<=this.values.length&&""!==this._input.value?(a.stopPropagation(),this._input.value=""):this._tokenize()}.bind(this),0))},_onFocusHandler:function(a){this._updateTokens();this._tokenize()},_onBlurHandler:function(a){this._input.value=
"";this._menu&&(this._menu.style.opacity="0",setTimeout(function(){this._menu.remove()}.bind(this),500))}};var G=e.TextArea=function(a){a=a||{};this.regexp=a.regexp||null;var b=a.attribute||{};b.id=a.id||null;b["class"]=a.className||null;b.placeholder=a.placeholder||null;b=new f("textarea",b);n(b,this);b.addClassName(e.className+" "+e.className+"-textarea");a.icon&&(b.addClassName(e.className+"-icon"),b.setStyle({backgroundImage:"url("+a.icon+")"}));a.value&&b.setValue(a.value);a.style&&b.setStyle(a.style);
a.isDisabled&&b.disable();return b};e.createTextArea=function(a){return new G(a)};G.prototype={disable:function(){this.addClassName(e.className+"-disabled");this.writeAttribute("disabled",!0);return this},enable:function(){this.removeClassName(e.className+"-disabled");this.writeAttribute("disabled",!1);return this},isEnabled:function(){return!this.hasClassName(e.className+"-disabled")},getValue:function(){return this.value||""},setValue:function(a){this.value=a;return this},isValid:function(){return this.regexp.test(this.getValue())}};
var H=e.Select=function(a){a=a||{};this.items=a.items||[];this.listView=a.listView||!1;this.multiple=a.multiple||!1;this.max=a.max||-1;this.multiple?this.selectedIndexes=a.selectedIndexes||[]:this.selectedIndex="undefined"===typeof a.selectedIndex?-1:a.selectedIndex;var b=a.attribute||{};a.id&&(b.id=a.id);this.isPulldown=!this.listView&&!this.multiple;var c=new f("div",b),d=function(a){return function(){c.select(a)}},h=function(a){return function(){c.deselect(a)}},k,b=0;for(k=this.items.length;b<
k;b++)"object"!==typeof this.items[b]&&(this.items[b]={label:"string"===typeof this.items[b]?this.items[b]:this.items[b].toString(10),value:this.items[b]});this.isPulldown?c._pulldown=(new M({label:"-",items:function(){var a=[{label:"-",onSelect:d(-1)}],b,c;b=0;for(c=this.items.length;b<c;b++)a.push({label:this.items[b].label,icon:this.items[b].icon,onSelect:d(b)});return a}.call(this)})).insertTo(c):c._grid=(new e.Grid({headless:!0,multiSelect:this.multiple,cols:[{key:"label"}],rows:function(){var a=
[],b,c;b=0;for(c=this.items.length;b<c;b++)a.push({cell:{label:{text:this.items[b].label,icon:this.items[b].icon}},onSelect:d(b),onDeselect:h(b)});return a}.call(this)})).insertTo(c);n(c,this);c.addClassName(e.className+" "+e.className+"-select");c.isPulldown||c.addClassName(e.className+"-select-list-view");a.className&&c.addClassName(a.className);a.style&&c.setStyle(a.style);a.isDisabled&&c.disable();c.multiple?c.selectedIndexes.forEach(function(a){c.select(a)}):-1<c.selectedIndex&&c.select(c.selectedIndex);
return c};e.createSelect=function(a){return new H(a)};H.prototype={select:function(a){if(this.items.length<=a)return this;if(this.multiple){if(-1<this.max&&this.selectedIndexes.length>=this.max)return!0===this._grid.rows[a].isSelected&&this._grid.deselect(a),this;-1===this.selectedIndexes.indexOf(a)&&this.selectedIndexes.push(a)}else this.selectedIndex=a;this.isPulldown?(-1===a?(this._pulldown.setLabel("-"),this._pulldown.setIcon(null)):(this._pulldown.setLabel(this.items[a].label),this._pulldown.setIcon(this.items[a].icon)),
this.fire("change")):this._grid.rows[a].isSelected||this._grid.select(a);return this},deselect:function(a){if(this.items.length<=a)return this;this.multiple?-1!==this.selectedIndexes.indexOf(a)&&this.selectedIndexes.splice(this.selectedIndexes.indexOf(a),1):this.selectedIndex=-1;if(this.isPulldown)this._pulldown.setLabel("-"),this._pulldown.setIcon(null),this.fire("change");else if(this.multiple)!0===this._grid.rows[a].isSelected&&this._grid.deselect(a);else{var b;a=0;for(b=this.items.length;a<b;a++)!0===
this._grid.rows[a].isSelected&&this._grid.deselect(a)}return this},selectAll:function(){if(this.multiple){this._grid.selectAll();this.selectedIndexes=[];var a,b;a=0;for(b=this.items.length;a<b;a++)this.selectedIndexes.push(a)}return this},deselectAll:function(){this.multiple?(this._grid.deselectAll(),this.selectedIndexes=[]):this.deselect();return this},disable:function(){this.addClassName(e.className+"-disabled");this.isPulldown?this._pulldown.disable():this._grid.disable();return this},enable:function(){this.removeClassName(e.className+
"-disabled");this.isPulldown?this._pulldown.enable():this._grid.enable();return this},isEnabled:function(){return!this.hasClassName(e.className+"-disabled")},getValue:function(){if(-1<this.selectedIndex)return this.items[this.selectedIndex].value},getValues:function(){var a,b,c=[];a=0;for(b=this.selectedIndexes.length;a<b;a++)c.push(this.items[this.selectedIndexes[a]].value);return c}};var I=e.ComboBox=function(a){a=a||{};this.items=a.items||[];this.regexp=a.regexp||null;var b=a.attribute||{};a.id&&
(b.id=a.id);var c=new f("div",b);c._textinput=(new w({value:a.value,placeholder:a.placeholder,icon:a.icon})).insertTo(c);var d=function(a){return function(){c.setValue(a);c._textinput.focus();c.fire("change")}};c._button=(new q({onSelect:function(){if(c._menu)c._menu.remove(),delete c._menu;else{var a=[],b,f;b=0;for(f=c.items.length;b<f;b++)a.push({label:c.items[b],onSelect:d(c.items[b])});var l=c._menu=(new y({className:e.className+"-combobox-menu",items:a,onSelect:function(){l.remove();delete c._menu}})).insertTo(c),
a=l.getHeight();b=parseInt(l.getStyle("margin-top").replace("px",""),10);var r=c.cumulativeOffset().top;f=-window.pageYOffset+r;r=window.pageYOffset+window.innerHeight-r-c.getHeight();a+b>r&&(f>r?(f<a+b&&(l.style.maxHeight=f-b-b+"px"),l.addClassName(e.className+"-combobox-menu-upper")):l.style.maxHeight=r-b-b+"px");var g=function(a){document.body.removeEventListener("click",g);c.parentNode.removeEventListener("click",g);c.off("click",g);l.style.opacity="0";setTimeout(function(){l.remove()}.bind(this),
500);delete c._menu};setTimeout(function(){document.body.addEventListener("click",g);c.parentNode.addEventListener("click",g);c.on("click",g)},0)}}})).insertTo(c);n(c,this);c.addClassName(e.className+" "+e.className+"-combobox");a.className&&c.addClassName(a.className);a.style&&c.setStyle(a.style);a.isDisabled&&c.disable();return c};e.createComboBox=function(a){return new I(a)};I.prototype={disable:function(){this.addClassName(e.className+"-disabled");this._textinput.disable();this._button.disable();
return this},enable:function(){this.removeClassName(e.className+"-disabled");this._textinput.enable();this._button.enable();return this},isEnabled:function(){return!this.hasClassName(e.className+"-disabled")},getValue:function(){return this._textinput.value},setValue:function(a){this._textinput.value=a;return this},isValid:function(a){return this.regexp.test(this.getValue())}};var v=e.Checkbox=function(a){var b="flagrate-checkbox-"+(++v.idCounter).toString(10);a=a||{};this.onChange=a.onChange||null;
this.onCheck=a.onCheck||null;this.onUncheck=a.onUncheck||null;var c=a.attribute||{};c.id=a.id||null;c["class"]=a.className||null;var d=(new f("label",c)).updateText(a.label);d.writeAttribute("for",b);n(d,this);d.addClassName(e.className+" "+e.className+"-checkbox");a.icon&&(d.addClassName(e.className+"-icon"),d.setStyle({backgroundImage:"url("+a.icon+")"}));d._input=new f("input",{id:b,type:"checkbox"});d.insert({top:new f});d.insert({top:d._input});d._input.on("click",function(a){a.stopPropagation();
a.targetCheckbox=d;d.isChecked()?d.uncheck():d.check();if(d.isChecked()){if(d.onCheck)d.onCheck(a)}else if(d.onUncheck)d.onUncheck(a);if(d.onChange)d.onChange(a);d.fire("change")});d._input.on("change",function(a){a.stopPropagation()});d._checked=!1;a.isChecked&&d.check();a.isDisabled&&d.disable();return d};e.createCheckbox=function(a){return new v(a)};v.idCounter=0;v.prototype={disable:function(){this.addClassName(e.className+"-disabled");this._input.writeAttribute("disabled",!0);return this},enable:function(){this.removeClassName(e.className+
"-disabled");this._input.writeAttribute("disabled",!1);return this},isEnabled:function(){return!this.hasClassName(e.className+"-disabled")},isChecked:function(){return this._checked},check:function(){this._checked=this._input.checked=!0;return this},uncheck:function(){this._checked=this._input.checked=!1;return this}};var J=e.Checkboxes=function(a){a=a||{};this.items=a.items||[];var b=a.attribute||{};a.id&&(b.id=a.id);var b=new f("div",b),c,d;c=0;for(d=this.items.length;c<d;c++)"object"!==typeof this.items[c]&&
(this.items[c]={label:"string"===typeof this.items[c]?this.items[c]:this.items[c].toString(10),value:this.items[c]}),this.items[c]._checkbox=(new v({label:this.items[c].label,icon:this.items[c].icon,isChecked:this.items[c].isChecked,onCheck:this.items[c].onCheck,onUncheck:this.items[c].onUncheck})).insertTo(b);n(b,this);b.addClassName(e.className+" "+e.className+"-checkboxes");a.className&&b.addClassName(a.className);a.style&&b.setStyle(a.style);a.isDisabled&&b.disable();a.values&&b.setValues(a.values);
return b};e.createCheckboxes=function(a){return new J(a)};J.prototype={select:function(a){this.items[a]&&this.items[a]._checkbox.check();return this},deselect:function(a){this.items[a]&&this.items[a]._checkbox.uncheck();return this},getValues:function(){var a=[],b,c;b=0;for(c=this.items.length;b<c;b++)!0===this.items[b]._checkbox.isChecked()&&a.push(this.items[b].value);return a},addValue:function(a){var b,c;b=0;for(c=this.items.length;b<c;b++)if(this.items[b].value===a){this.select(b);break}return this},
removeValue:function(a){var b,c;b=0;for(c=this.items.length;b<c;b++)if(this.items[b].value===a){this.deselect(b);break}return this},setValues:function(a){var b,c;b=0;for(c=this.items.length;b<c;b++)-1===a.indexOf(this.items[b].value)?this.deselect(b):this.select(b);return this},selectAll:function(){var a,b;a=0;for(b=this.items.length;a<b;a++)this.select(a);return this},deselectAll:function(){return this.setValues([])},enable:function(){var a,b;a=0;for(b=this.items.length;a<b;a++)this.items[a]._checkbox.enable();
return this},disable:function(){var a,b;a=0;for(b=this.items.length;a<b;a++)this.items[a]._checkbox.disable();return this}};var z=e.Radio=function(a){var b="flagrate-radio-"+(++z.idCounter).toString(10);a=a||{};var c=a.attribute||{};c.id=a.id||null;c["class"]=a.className||null;var d=(new f("label",c)).updateText(a.label);d.writeAttribute("for",b);n(d,this);d.addClassName(e.className+" "+e.className+"-radio");a.icon&&(d.addClassName(e.className+"-icon"),d.setStyle({backgroundImage:"url("+a.icon+")"}));
d._input=new f("input",{id:b,type:"radio",name:a.name});d.insert({top:new f});d.insert({top:d._input});d._input.on("change",function(){this.isChecked()?d.fire("check"):d.fire("uncheck")}.bind(d));a.isChecked&&d.check();a.isDisabled&&d.disable();return d};e.createRadio=function(a){return new z(a)};z.idCounter=0;z.prototype={disable:function(){this.addClassName(e.className+"-disabled");this._input.writeAttribute("disabled",!0);return this},enable:function(){this.removeClassName(e.className+"-disabled");
this._input.writeAttribute("disabled",!1);return this},isEnabled:function(){return!this.hasClassName(e.className+"-disabled")},isChecked:function(){return!!this._input.checked},check:function(){this._input.checked=!0;return this},uncheck:function(){this._input.checked=!1;return this}};var C=e.Radios=function(a){a=a||{};this.items=a.items||[];var b="flagrate-radios-"+ ++z.idCounter;this.selectedIndex=a.selectedIndex||-1;var c=a.attribute||{};a.id&&(c.id=a.id);var d=new f("div",c),c=function(a){return function(){d.selectedIndex=
a}},h,k;h=0;for(k=this.items.length;h<k;h++)"object"!==typeof this.items[h]&&(this.items[h]={label:"string"===typeof this.items[h]?this.items[h]:this.items[h].toString(10),value:this.items[h]}),this.items[h]._radio=(new z({label:this.items[h].label,icon:this.items[h].icon,name:b})).on("check",c(h)).insertTo(d);n(d,this);d.addClassName(e.className+" "+e.className+"-radios");a.className&&d.addClassName(a.className);a.style&&d.setStyle(a.style);a.isDisabled&&d.disable();-1<d.selectedIndex&&this.items[d.selectedIndex]._radio.check();
return d};e.createRadios=function(a){return new C(a)};C.idCounter=0;C.prototype={select:function(a){void 0!==this.items[a]&&(this.selectedIndex=a,this.items[a]._radio.check());return this},getValue:function(){return-1===this.selectedIndex?void 0:this.items[this.selectedIndex].value},setValue:function(a){var b,c;b=0;for(c=this.items.length;b<c;b++)if(this.items[b].value===a){this.select(b);break}return this},enable:function(){var a,b;a=0;for(b=this.items.length;a<b;a++)this.items[a]._radio.enable();
return this},disable:function(){var a,b;a=0;for(b=this.items.length;a<b;a++)this.items[a]._radio.disable();return this}};var K=e.Switch=function(a){a=a||{};var b=new q({id:a.id,className:a.className,attribute:a.attribute,style:a.style,isFocused:a.isFocused,isDisabled:a.isDisabled});n(b,this);b.onSelect=b.toggleSwitch.bind(b);b.addClassName(e.className+"-switch");b.dataset?b.dataset.flagrateSwitchStatus=a.isOn?"on":"off":b.writeAttribute("data-flagrate-switch-status",a.isOn?"on":"off");return b};e.createSwitch=
function(a){return new K(a)};K.prototype={isOn:function(){return this.dataset?"on"===this.dataset.flagrateSwitchStatus:"on"===this.readAttribute("data-flagrate-switch-status")},switchOn:function(){this.dataset?this.dataset.flagrateSwitchStatus="on":this.writeAttribute("data-flagrate-switch-status","on");return this.fire("on").fire("change")},switchOff:function(){this.dataset?this.dataset.flagrateSwitchStatus="off":this.writeAttribute("data-flagrate-switch-status","off");return this.fire("off").fire("change")},
toggleSwitch:function(){return this.isOn()?this.switchOff():this.switchOn()}};var L=e.Progress=function(a){a=a||{};this.value=a.value||0;this.max=a.max||100;var b=a.attribute||{};b.id=a.id||null;b["class"]=a.className||null;a=new f("div",b);n(a,this);a.addClassName(e.className+" "+e.className+"-progress");a._bar=(new f).insertTo(a);a._updateProgress();return a};e.createProgress=function(a){return new L(a)};L.prototype={getValue:function(){return this.value},setValue:function(a){if("number"!==typeof a)return this;
this.value=Math.max(0,Math.min(this.max,a));this.fire("change");return this._updateProgress()},_updateProgress:function(){var a=Math.max(0,Math.min(100,this.value/this.max*100));this._bar.setStyle({width:a+"%"});return this}};var O=e.Slider=function(a){a=a||{};var b=new L(a);n(b,this);b.addClassName(e.className+"-slider");if(void 0!==window.ontouchstart)b.on("touchstart",b._onPointerDownHandler.bind(b));if(navigator.pointerEnabled)b.on("pointerdown",b._onPointerDownHandler.bind(b));else if(navigator.msPointerEnabled)b.on("MSPointerDown",
b._onPointerDownHandler.bind(b));else b.on("mousedown",b._onPointerDownHandler.bind(b));a.isDisabled&&b.disable();return b};e.createSlider=function(a){return new O(a)};O.prototype={disable:function(){return this.addClassName(e.className+"-disabled")},enable:function(){return this.removeClassName(e.className+"-disabled")},isEnabled:function(){return!this.hasClassName(e.className+"-disabled")},_onPointerDownHandler:function(a){if(this.isEnabled()){a.preventDefault();var b=0,c=0;switch(a.type){case "mousedown":case "MSPointerDown":case "pointerdown":b=
a.offsetX||a.layerX;c=a.clientX;break;case "touchstart":b=a.touches[0].pageX-this.cumulativeOffset().left,c=a.touches[0].clientX}this._slide(b,c)}},_slide:function(a,b){var c=this.getWidth()/this.max,d=function(d){d.preventDefault();d.touches&&d.touches[0]?(a=a+d.touches[0].clientX-b,b=d.touches[0].clientX):(a=a+d.clientX-b,b=d.clientX);this.setValue(Math.round(a/c));this.fire("slide")}.bind(this),e=function(f){f.preventDefault();void 0!==window.ontouchend&&(document.removeEventListener("touchmove",
d),document.removeEventListener("touchend",e),document.removeEventListener("touchcancel",e));navigator.pointerEnabled?(document.removeEventListener("pointermove",d),document.removeEventListener("pointerup",e)):navigator.msPointerEnabled?(document.removeEventListener("MSPointerUp",e),document.removeEventListener("MSPointerMove",d)):(document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",e));f.touches&&f.touches[0]&&(a=a+f.touches[0].clientX-b,this.setValue(Math.round(a/
c)),this.fire("slide"));f.clientX&&(a=a+f.clientX-b,this.setValue(Math.round(a/c)),this.fire("slide"))}.bind(this);void 0!==window.ontouchend&&(document.addEventListener("touchmove",d),document.addEventListener("touchend",e),document.addEventListener("touchcancel",e));navigator.pointerEnabled?(document.addEventListener("pointermove",d),document.addEventListener("pointerup",e)):navigator.msPointerEnabled?(document.addEventListener("MSPointerMove",d),document.addEventListener("MSPointerUp",e)):(document.addEventListener("mousemove",
d),document.addEventListener("mouseup",e));this.setValue(Math.round(a/c));this.fire("slide")}};var P=e.Tab=function(a){a=a||{};this.tabs=a.tabs||[];this.bodyless=a.bodyless||!1;this.onSelect=a.onSelect||null;var b=a.attribute||[];b.id=a.id;b["class"]=e.className+" "+e.className+"-tab";a.fill&&(b["class"]+=" "+e.className+"-tab-fill");b=new f("div",b);n(b,this);a.className&&b.addClassName(a.className);a.style&&b.setStyle(a.style);b.selectedIndex=a.selectedIndex||0;b._create()._render();0<b.tabs.length&&
b.select(b.selectedIndex);return b};e.createTab=function(a){return new P(a)};P.prototype={select:function(a){a="number"===typeof a?a:this.indexOf(a);if(0>a||a>=this.tabs.length)return this;0<=this.selectedIndex&&this.selectedIndex<this.tabs.length&&this.tabs[this.selectedIndex]._button&&this.tabs[this.selectedIndex]._button.removeClassName(e.className+"-tab-selected");this.selectedIndex=a;a=this.tabs[a];if(!a||!a._button)return this;a._button.addClassName(e.className+"-tab-selected");a.text&&this._body.updateText(a.text);
a.html&&this._body.update(a.html);a.element&&this._body.update(a.element);if(a.onSelect)a.onSelect(window.event,a);if(this.onSelect)this.onSelect(window.event,a);return this},unshift:function(a){if(a instanceof Array){var b,c;b=0;for(c=a.length;b<c;b++)this.tabs.unshift(a)}else this.tabs.unshift(a);this._render();return this.tabs.length},push:function(a){if(a instanceof Array){var b,c;b=0;for(c=a.length;b<c;b++)this.tabs.push(a)}else this.tabs.push(a);this._render();return this.tabs.length},shift:function(a){a=
a||1;var b=[],c,d;c=0;for(d=this.tabs.length;c<d&&c<a;c++)b.push(this.tabs.shift());this._render();return 1===a?b[0]:b},pop:function(a){a=a||1;var b=[],c,d;c=0;for(d=this.tabs.length;c<d&&c<a;c++)b.push(this.tabs.pop());this._render();return 1===a?b[0]:b},splice:function(a,b,c){b="undefined"===typeof b?this.tabs.length-a:b;b=this.tabs.splice(a,b);if(c){!1===c instanceof Array&&(c=[c]);var d,e;d=0;for(e=c.length;d<e;d++)this.tabs.splice(a+d,0,c[d])}this._render();return b},removeTab:function(a){var b=
[];!1===a instanceof Array&&(a=[a]);var c,d;c=0;for(d=a.length;c<d;c++){var e="number"===typeof a[c]?a[c]:this.indexOf(a[c]);-1!==e&&b.push(this.splice(e,1))}return b[0]},indexOf:function(a){if("string"===typeof a){var b=-1,c,d;c=0;for(d=this.tabs.length;c<d;c++)if(this.tabs[c].key===a){b=c;break}return b}return this.tabs.indexOf(a)},_create:function(){this._head=(new f("div",{"class":e.className+"-tab-head"})).insertTo(this);this._body=!0===this.bodyless?new f:(new f("div",{"class":e.className+"-tab-body"})).insertTo(this);
return this},_render:function(){this._head.update();var a,b,c;a=0;for(b=this.tabs.length;a<b;a++)c=this.tabs[a],c._button||(c._button=new q({icon:c.icon,label:c.label,onSelect:this._createOnSelectHandler(this,c)})),c._button.insertTo(this._head);return this},_createOnSelectHandler:function(a,b){return function(c){a.select(b)}}};var A=e.Popover=function(a){a=a||{};this.target=a.target||null;var b=a.text||null,c=a.html||null,d=a.element||null;this.isShowing=!1;this.open=function(h){var k=window.event||
{},m=this.target||k.target||document.documentElement;h instanceof Event&&(k=h);h instanceof HTMLElement&&(m=h);this.isShowing&&this.close();this.isShowing=!0;var l=this._div=new f("div",{"class":e.className+" "+e.className+"-popover"});a.className&&l.addClassName(a.className);b&&l.updateText(b);c&&l.update(c);d&&l.update(d);l.style.opacity=0;l.insertTo(document.body);A._updatePosition(m,l);l.style.opacity=1;k.type&&"mouseover"===k.type&&(document.body.addEventListener("click",this.close),document.body.addEventListener("mouseout",
this.close),document.body.addEventListener("mouseup",this.close),document.body.addEventListener("mousewheel",this.close));var g=function(){!0===f.exists(m)?(A._updatePosition(m,l),this._positioningTimer=setTimeout(g,30)):this.close()}.bind(this);this._positioningTimer=setTimeout(g,30);h=function(a){a.stopPropagation();"mousewheel"===a.type&&a.preventDefault()};this._div.on("click",h);this._div.on("mouseup",h);this._div.on("mousewheel",h);return this}.bind(this);this.close=function(){clearTimeout(this._positioningTimer);
document.body.removeEventListener("click",this.close);document.body.removeEventListener("mouseup",this.close);document.body.removeEventListener("mouseout",this.close);document.body.removeEventListener("mousewheel",this.close);this.isShowing=!1;var a=this._div;setTimeout(function(){a&&a.remove&&a.remove()},0);delete this._div;return this}.bind(this);null!==this.target&&this.target.addEventListener("mouseover",this.open);return this};e.createPopover=function(a){return new A(a)};A.prototype={visible:function(){return this.isShowing},
remove:function(){this._div&&this.close();null!==this.target&&this.target.removeEventListener("mouseover",this.open)}};A._updatePosition=function(a,b){var c=f.cumulativeOffset(a),d=f.cumulativeScrollOffset(a),h=f.getWidth(a),k=f.getHeight(a),m=b.getWidth(),l=b.getHeight(),h=c.left-d.left+h/2-m/2,c=c.top-d.top+k;c+l>window.innerHeight?(c=window.innerHeight-c+k,b.removeClassName(e.className+"-popover-tail-top"),b.addClassName(e.className+"-popover-tail-bottom"),b.style.top="",b.style.bottom=c+"px"):
(b.removeClassName(e.className+"-popover-tail-bottom"),b.addClassName(e.className+"-popover-tail-top"),b.style.top=c+"px",b.style.bottom="");b.style.left=h+"px"};var Q=e.Tutorial=function(a){a=a||{};this.steps=a.steps||[];this.index=a.count||0;this.onFinish=a.onFinish||t;this.onAbort=a.onAbort||t;this.onClose=a.onClose||t};e.createTutorial=function(a){return new Q(a)};Q.prototype={visible:function(){return!!this._popover||!!this._modal||!!this._inStep},open:function(){!1===this.visible()&&this._main();
return this},close:function(){!0===this.visible()&&this._afterStep(this.onClose.bind(this));return this},abort:function(){!0===this.visible()&&this._afterStep(this.onAbort.bind(this));return this},finish:function(){this._afterStep(this.onFinish.bind(this));this.index=0;return this},prev:function(){this._afterStep(function(){0<this.index&&--this.index;this._main()}.bind(this));return this},next:function(){this._afterStep(function(){this.index+1<this.steps.length&&++this.index;this._main()}.bind(this));
return this},_main:function(){this._inStep=!0;var a=this.steps[this.index];if(a.onBeforeStep){if(a.onBeforeStep.length)return a.onBeforeStep(this._step.bind(this)),this;a.onBeforeStep()}this._step();return this},_step:function(){var a=this.steps[this.index],b=[];this.index+1>=this.steps.length?b.push({className:e.className+"-tutorial-button-finish",onSelect:function(){this._afterStep(this.finish.bind(this))}.bind(this)}):b.push({className:e.className+"-tutorial-button-next",onSelect:function(){this._afterStep(this.next.bind(this))}.bind(this)});
0<this.index&&b.push({className:e.className+"-tutorial-button-prev",onSelect:function(){this._afterStep(this.prev.bind(this))}.bind(this)});this.index+1<this.steps.length&&b.push({className:e.className+"-tutorial-button-abort",onSelect:function(){this._afterStep(this.abort.bind(this))}.bind(this)});b[0].color="@primary";var c;if(c=a.target&&"string"===typeof a.target?document.querySelector(a.target):a.target){var d=new f,h=new f;a.html&&h.insert(a.html).insertTo(d);a.text&&h.insertText(a.text).insertTo(d);
var k=(new f("footer")).insertTo(d);b.forEach(function(a){(new q(a)).insertTo(k)});this._popover=new A({className:e.className+"-tutorial",element:d});this._popover.open(c)}else this._modal=new e.Modal({disableCloseByMask:!0,disableCloseButton:!0,disableCloseByEsc:!0,className:e.className+"-tutorial",title:a.title,text:a.text,html:a.html,buttons:b}),this._modal.open();if(a.onStep)a.onStep();return this},_afterStep:function(a){var b=this._inStep=!1;this._popover&&(b=!0,this._popover.remove(),delete this._popover);
this._modal&&(b=!0,this._modal.close(),delete this._modal);if(!0===b&&(b=this.steps[this.index],b.onAfterStep)){if(b.onAfterStep.length)return b.onAfterStep(a),this;b.onAfterStep()}a();return this}};var R=e.Notify=function(a){a=a||{};this.target=a.target||document.body;this.className=a.className||null;this.disableDesktopNotify=a.disableDesktopNotify||!1;this.disableFocusDetection=a.disableFocusDetection||!1;this.hAlign=a.hAlign||"right";this.vAlign=a.vAlign||"bottom";this.hMargin=a.hMargin||10;this.vMargin=
a.vMargin||10;this.spacing=a.spacing||10;this.timeout=a.timeout||5;this.title=a.title||"Notify";this.notifies=[];!1===this.disableDesktopNotify&&(this.desktopNotifyType=null,void 0!==window.Notification&&window.Notification.permission?this.desktopNotifyType="w3c":void 0!==window.webkitNotifications?this.desktopNotifyType="webkit":this.disableDesktopNotify=!0,"file:"!==window.location.protocol&&("w3c"===this.desktopNotifyType&&"default"===window.Notification.permission&&this.create({text:"Click here to activate desktop notifications...",
onClick:function(){window.Notification.requestPermission()}.bind(this)}),"webkit"===this.desktopNotifyType&&1===window.webkitNotifications.checkPermission()&&this.create({text:"Click here to activate desktop notifications...",onClick:function(){window.webkitNotifications.requestPermission()}.bind(this)})));return this};e.createNotify=function(a){return new R(a)};R.prototype={create:function(a){a=a||{};"string"===typeof a&&(a={text:a});if(!1===this.disableDesktopNotify){var b=document.hasFocus?document.hasFocus():
!1;if(!1===this.disableFocusDetection&&!1===b&&!0===this.createDesktopNotify(a))return this}var c=a.title||this.title,d=a.message||a.body||a.content||a.text||null,h=a.onClick||null,k=a.onClose||null,m=void 0!==a.timeout?a.timeout:this.timeout,l=!0,g,b=this.hMargin,n=this.vMargin,p=new f("div",{"class":this.className});p.addClassName(e.className+" "+e.className+"-notify");(new f("div",{"class":"title"})).insertText(c).insertTo(p);(new f("div",{"class":"text"})).insertText(d).insertTo(p);c=(new f("div",
{"class":"close"})).update("&#xd7;").insertTo(p);a.icon&&(p.addClassName(e.className+"-notify-icon"),(new f("div",{"class":"icon"})).setStyle({backgroundImage:"url("+a.icon+")"}).insertTo(p));var q=function(){l=!1;p.style.opacity=0;null!==k&&k();setTimeout(function(){this.target.removeChild(p);this.notifies.splice(this.notifies.indexOf(p),1);this.positioner()}.bind(this),300)}.bind(this);c.on("click",function(a){a.stopPropagation();a.preventDefault();l&&q()},!1);p.style.display="none";p.style.position=
"fixed";p.style[this.hAlign]=b+"px";p.style[this.vAlign]=n+"px";if(null===h)p.on("click",function(a){q()});else p.style.cursor="pointer",p.on("click",function(a){a.stopPropagation();a.preventDefault();h();q()});this.target.appendChild(p);p.style.display="block";setTimeout(function(){p.style.opacity=1},10);if(0!==m){var t=function(){l&&q()};g=setTimeout(t,1E3*m);p.on("mouseover",function(){clearTimeout(g);g=setTimeout(t,1E3*m)})}this.notifies.push(p);this.positioner();return this},createDesktopNotify:function(a){var b=
a.title||this.title,c=a.message||a.body||a.content||a.text||null,d=a.onClick||null,e=a.onClose||null,f=void 0!==a.timeout?a.timeout:this.timeout,m=!0,l=null,g=this.desktopNotifyType;if("w3c"===g){if("granted"!==window.Notification.permission)return!1;l=new window.Notification(b,{icon:a.icon,body:c})}if("webkit"===g){if(0!==window.webkitNotifications.checkPermission())return!1;l=window.webkitNotifications.createNotification("",b,c)}0!==f&&setTimeout(function(){m&&("w3c"===g?l.close():l.cancel())},
1E3*f);null===d?l.addEventListener("click",function(a){"w3c"===g?l.close():l.cancel()}):l.addEventListener("click",function(a){d();"w3c"===g?l.close():l.cancel()});l.onclose=function(){m=!1;null!==e&&e()};l.show&&l.show();return!0},positioner:function(){var a=this.target===document.body?window.innerHeight||document.body.clientHeight:this.target.offsetHeight,b=0,c=0,d,e;d=0;for(e=this.notifies.length;d<e;d++){var f=this.notifies[d],m=this.hMargin+c;f.style[this.hAlign]=(this.vMargin+b).toString(10)+
"px";f.style[this.vAlign]=m.toString(10)+"px";c+=this.spacing+f.offsetHeight;c+f.offsetHeight+this.vMargin+this.spacing>=a&&(c=0,b+=this.spacing+f.offsetWidth)}}};var S=e.Modal=function(a){a=a||{};this.target=a.target||document.body;this.id=a.id||null;this.className=a.className||null;this.title=a.title||"";this.subtitle=a.subtitle||a.description||"";this.text=a.text||"";this.html=a.html||"";this.element=a.element||a.content||null;this.href=a.href||"";this.buttons=a.buttons||[];this.sizing=a.sizing||
"flex";this.onBeforeClose=a.onBeforeClose||t;this.onClose=a.onClose||t;this.onShow=a.onShow||t;this.disableCloseButton=a.disableCloseButton||!1;this.disableCloseByMask=a.disableCloseByMask||!1;this.disableCloseByEsc=a.disableCloseByEsc||!1;0===this.buttons.length&&(this.buttons=[{label:"OK",color:"@primary",onSelect:this.close.bind(this),isFocused:!0}]);this._modal=new f("div");this._modal.on("click",function(a){a.stopPropagation()});!1===this.disableCloseButton&&(this._closeButton=(new q({label:"",
onSelect:this.close.bind(this)})).insertTo(this._modal));this._header=(new f("hgroup")).insertTo(this._modal);(new f("h1")).insertText(this.title).insertTo(this._header);(new f("small")).insertText(this.subtitle).insertTo(this._header);this._content=(new f("div")).insertTo(this._modal);this.content=(new f("div")).insertTo(this._content);""!==this.text&&this.content.insertText(this.text);""!==this.html&&this.content.update(this.html);null!==this.element&&this.content.update(this.element);this._footer=
(new f("footer")).insertTo(this._modal);var b;a=0;for(b=this.buttons.length;a<b;a++){var c=this.buttons[a];c.button=new q({className:c.className,label:c.label,icon:c.icon,color:c.color,isFocuesed:c.isFocused||!1,isDisabled:c.isDisabled,onSelect:this._createButtonOnSelectHandler(this,c)});c.disable=c.button.disable.bind(c.button);c.enable=c.button.enable.bind(c.button);c.setColor=c.button.setColor.bind(c.button);this._footer.insert(c.button)}this._base=new f("div",{id:this.id,"class":this.className});
this.target!==document.body&&(this._base.style.position="absolute");this._base.addClassName(e.className+" "+e.className+"-modal "+e.className+"-sizing-"+this.sizing);this._obi=(new f("div")).update(this._modal).insertTo(this._base);if(!1===this.disableCloseByMask)this._base.on("click",this.close.bind(this));this._onKeydownHandler=function(a){var b=document.activeElement&&document.activeElement.tagName;if(("BODY"===b||"DIV"===b||"BUTTON"===b)&&""===window.getSelection().toString()){var c=!1;9===a.keyCode&&
"BUTTON"!==b&&(c=!0,this._closeButton?this._closeButton.focus():this.buttons[0]&&this.buttons[0].button.focus());13===a.keyCode&&this.buttons[0]&&"BUTTON"!==b&&(c=!0,this.buttons[0].button.click());27===a.keyCode&&!1===this.disableCloseByEsc&&(c=!0,this.close());!0===c&&(a.stopPropagation(),a.preventDefault())}}.bind(this);return this};e.createModal=function(a){return new S(a)};S.prototype={visible:function(){return this._base.hasClassName(e.className+"-modal-visible")},open:function(){if(!0===this.visible())return this;
document.activeElement&&document.activeElement.blur&&document.activeElement.blur();window.getSelection().removeAllRanges();this.closingTimer&&clearTimeout(this.closingTimer);f.insert(this.target,this._base);setTimeout(function(){this._base.addClassName(e.className+"-modal-visible")}.bind(this),0);this.onShow(this);var a=-1,b=-1,c=-1,d=-1,h=function(){if(a!==this._base.getWidth()||b!==this._base.getHeight()||c!==this._modal.getWidth()||d!==this._modal.getHeight())a=this._base.getWidth(),b=this._base.getHeight(),
c=this._modal.getWidth(),d=this._modal.getHeight(),"flex"===this.sizing&&(a-20<=c?(this._modal.style.left="0",this._content.style.width=a+"px",this._content.style.overflowX="auto"):(this._modal.style.left=Math.floor(a/2-c/2)+"px",this._content.style.width="",this._content.style.overflowX="visible"),b-20<=d?(this._obi.style.top="10px",this._obi.style.bottom="10px",this._obi.style.height="",this._content.style.height=b-this._header.getHeight()-this._footer.getHeight()-20+"px",this._content.style.overflowY=
"auto"):(this._obi.style.top=b/2-d/2+"px",this._obi.style.bottom="",this._obi.style.height=d+"px",this._content.style.height="",this._content.style.overflowY="visible")),"full"===this.sizing&&(this._modal.style.right="10px",this._modal.style.left="10px",this._content.style.overflowX="auto",this._obi.style.top="10px",this._obi.style.bottom="10px",this._obi.style.height="",this._content.style.height=b-this._header.getHeight()-this._footer.getHeight()-20+"px",this._content.style.overflowY="auto");this.positioningTimer=
setTimeout(h.bind(this),30)};this.positioningTimer=setTimeout(h.bind(this),0);this.buttons[0]&&this.buttons[0].button.focus();window.addEventListener("keydown",this._onKeydownHandler,!0);return this},show:function(){return this.open()},render:function(){return this.open()},close:function(a){if(!1===this.visible())return this;this._base.removeClassName(e.className+"-modal-visible");a&&(a.stopPropagation(),a.preventDefault());if(!1===this.onBeforeClose(this,a))return this;clearTimeout(this.positioningTimer);
this.closingTimer=setTimeout(function(){this._base.remove()}.bind(this),200);!1===this.disableCloseByEsc&&window.removeEventListener("keydown",this._onKeydownHandler);this.onClose(this,a);return this},getButtonByKey:function(a){var b=null,c=this.buttons,d;for(d=0;d<c.length;d++)if(c[d].key&&c[d].key===a){b=c[d].button;break}return b},getButtons:function(){return this.buttons||[]},_createButtonOnSelectHandler:function(a,b){return function(c){try{if(b.onSelect)b.onSelect(c,a);if(b.onClick)b.onClick(c,
a)}catch(d){throw Error("flagrate.Modal: "+d);}}}};var D=e.Grid=function(a){a=a||{};this.id=a.id||null;this.className=a.className||null;this.attribute=a.attribute||null;this.style=a.style||null;this.cols=a.cols||[];this.rows=a.rows||[];this.pagination=a.pagination||!1;this.fill=a.fill||!1;this.headless=a.headless||!1;this.multiSelect=a.multiSelect||!1;this.disableCheckbox=a.disableCheckbox||!1;this.disableSelect=a.disableSelect||!1;this.disableSort=a.disableSort||!1;this.disableFilter=a.disableFilter||
!1;this.disableResize=a.disableResize||!1;this.onSelect=a.onSelect||null;this.onDeselect=a.onDeselect||null;this.onClick=a.onClick||null;this.onDblClick=a.onDblClick||null;this.onRender=a.onRender||null;this.onRendered=a.onRendered||null;this.postProcessingOfRow=a.postProcessingOfRow||null;this._id="flagrate-grid-"+(++D.idCounter).toString(10);this._selectedRows=[];this.pagination&&(this.numberOfRowsPerPage=a.numberOfRowsPerPage||20,this.pagePosition=0);this.headless&&(this.disableResize=this.disableSort=
!0);this.sortedByAsc=this.sortedByKey=null;return this._create()._requestRender()};e.createGrid=function(a){return new D(a)};D.idCounter=0;D.prototype={insertTo:function(a,b){return this.element.insertTo(a,b)&&this},select:function(a){var b,c,d;if(a instanceof Array)b=a;else for(b=[],c=0,d=arguments.length;c<d;c++)b.push(arguments[c]);!1===this.multiSelect&&this.deselectAll();c=0;for(d=b.length;c<d;c++){var f=b[c];"number"===typeof f&&(f=this.rows[f]);f.isSelected=!0;if(!f._tr||!0!==f._tr.hasClassName(e.className+
"-grid-row-selected")){this._selectedRows.push(f);f._tr&&f._tr.addClassName(e.className+"-grid-row-selected");f._checkbox&&f._checkbox.check();if(f.onSelect)f.onSelect(window.event,f);if(this.onSelect)this.onSelect(window.event,f)}}0!==this._selectedRows.length&&this._checkbox&&this._checkbox.check();this.element.fire("change");return this},deselect:function(a){var b,c,d;if(a instanceof Array)b=a;else for(b=[],c=0,d=arguments.length;c<d;c++)b.push(arguments[c]);c=0;for(d=b.length;c<d;c++){var f=b[c];
"number"===typeof f&&(f=this.rows[f]);f.isSelected=!1;if(!f._tr||!1!==f._tr.hasClassName(e.className+"-grid-row-selected")){this._selectedRows.splice(this._selectedRows.indexOf(f),1);f._tr&&f._tr.removeClassName(e.className+"-grid-row-selected");f._checkbox&&f._checkbox.uncheck();if(f.onDeselect)f.onDeselect(window.event,f);if(this.onDeselect)this.onDeselect(window.event,f)}}0===this._selectedRows.length&&this._checkbox&&this._checkbox.uncheck();this.element.fire("change");return this},selectAll:function(){return this.select(this.rows)},
deselectAll:function(){return this.deselect(this.rows)},getSelectedRows:function(){return this._selectedRows},sort:function(a,b){void 0===b&&(b=!0);this.rows.sort(function(b,c){var d=0,e=0;b.cell[a]&&(d=void 0!==b.cell[a].sortAlt?b.cell[a].sortAlt:b.cell[a].text||b.cell[a].html||b.cell[a].element&&b.cell[a].element.innerHTML||b.cell[a]._div&&b.cell[a]._div.innerHTML||0);c.cell[a]&&(e=void 0!==c.cell[a].sortAlt?c.cell[a].sortAlt:c.cell[a].text||c.cell[a].html||c.cell[a].element&&c.cell[a].element.innerHTML||
c.cell[a]._div&&c.cell[a]._div.innerHTML||0);return d===e?0:d>e?1:-1});!1===b&&this.rows.reverse();var c,d;c=0;for(d=this.cols.length;c<d;c++)this.cols[c].key===a?(this.cols[c]._th&&(b?(this.cols[c]._th.addClassName(e.className+"-grid-col-sorted-asc"),this.cols[c]._th.removeClassName(e.className+"-grid-col-sorted-desc")):(this.cols[c]._th.addClassName(e.className+"-grid-col-sorted-desc"),this.cols[c]._th.removeClassName(e.className+"-grid-col-sorted-asc"))),this.cols[c].isSorted=!0,this.cols[c].isAsc=
b,this.sortedByKey=a,this.sortedByAsc=b):(this.cols[c].isSorted&&this.cols[c]._th&&this.cols[c]._th.removeClassName(e.className+"-grid-col-sorted-asc").removeClassName(e.className+"-grid-col-sorted-desc"),this.cols[c].isSorted=!1,this.cols[c].isAsc=null);this._requestRender();return this},unshift:function(a){if(a instanceof Array){var b,c;b=0;for(c=a.length;b<c;b++)this.rows.unshift(a[b])}else this.rows.unshift(a);null===this.sortedByKey?this._requestRender():this.sort(this.sortedByKey,this.sortedByAsc);
return this.rows.length},push:function(a){if(a instanceof Array){var b,c;b=0;for(c=a.length;b<c;b++)this.rows.push(a[b])}else this.rows.push(a);null===this.sortedByKey?this._requestRender():this.sort(this.sortedByKey,this.sortedByAsc);return this.rows.length},shift:function(a){a=a||1;var b=[],c,d;c=0;for(d=this.rows.length;c<d&&c<a;c++)b.push(this.rows.shift());this._requestRender();return 1===a?b[0]:b},pop:function(a){a=a||1;var b=[],c,d;c=0;for(d=this.rows.length;c<d&&c<a;c++)b.push(this.rows.pop());
this._requestRender();return 1===a?b[0]:b},splice:function(a,b,c){b="undefined"===typeof b?this.rows.length-a:b;b=this.rows.splice(a,b);if(c){!1===c instanceof Array&&(c=[c]);var d,e;d=0;for(e=c.length;d<e;d++)this.rows.splice(a+d,0,c[d])}null===this.sortedByKey?this._requestRender():this.sort(this.sortedByKey,this.sortedByAsc);return b},indexOf:function(a,b){return this.rows.indexOf(a,b)},removeRow:function(a){var b=[];!1===a instanceof Array&&(a=[a]);var c,d;c=0;for(d=a.length;c<d;c++){var e=this.indexOf(a[c]);
-1!==e&&b.push(this.splice(e,1))}return b[0]},disable:function(){this.element.addClassName(e.className+"-disabled");return this},enable:function(){this.element.removeClassName(e.className+"-disabled");return this},isEnabled:function(){return!this.element.hasClassName(e.className+"-disabled")},_create:function(){this.element=new f("div");this.id&&this.element.writeAttribute("id",this.id);this.className&&this.element.writeAttribute("class",this.className);this.attribute&&this.element.writeAttribute(this.attribute);
this.style&&this.element.setStyle(this.style);this.element.addClassName(e.className+" "+e.className+"-grid");this.headless&&this.element.addClassName(e.className+"-grid-headless");this._head=(new f("div",{"class":e.className+"-grid-head"})).insertTo(this.element);this._thead=(new f("thead")).insertTo((new f("table")).insertTo(this._head));this._body=(new f("div",{"class":e.className+"-grid-body"})).insertTo(this.element);this._tbody=(new f("tbody")).insertTo((new f("table")).insertTo(this._body));
this._style=(new f("style")).insertTo(this.element);this._style.type="text/css";var a=(new f("tr")).insertTo(this._thead);!1===this.disableCheckbox&&!1===this.disableSelect&&!0===this.multiSelect&&(this._checkbox=(new v({onCheck:this.selectAll.bind(this),onUncheck:this.deselectAll.bind(this)})).insertTo((new f("th",{"class":e.className+"-grid-cell-checkbox"})).insertTo(a)));var b,c;b=0;for(c=this.cols.length;b<c;b++){var d=this.cols[b];d._id=this._id+"-col-"+b.toString(10);d._th=(new f("th")).insertTo(a);
d.id&&d._th.writeAttribute("id",d.id);d.className&&d._th.writeAttribute("class",d.className);d.attribute&&d._th.writeAttribute(d.attribute);d.style&&d._th.setStyle(d.style);d._th.addClassName(d._id);var h=d.width?d.width.toString(10)+"px":"auto";this._style.insertText("."+d._id+"{width:"+h+"}");d.align&&(d._th.style.textAlign=d.align);d._div=(new f).insertTo(d._th);d.label&&d._div.updateText(d.label);d.icon&&(d._div.addClassName(e.className+"-icon"),d._div.setStyle({backgroundImage:"url("+d.icon+
")"}));!1!==this.disableResize||d.disableResize||(d._resizeHandle=(new f("div",{"class":e.className+"-grid-col-resize-handle"})).insertTo(this.element),d._resizeHandle.onmousedown=this._createResizeHandleOnMousedownHandler(this,d));!1!==this.disableSort||d.disableSort||(d._th.addClassName(e.className+"-grid-col-sortable"),d._th.onclick=this._createColOnClickHandler(this,d))}(new f("th",{"class":this._id+"-col-last"})).insertTo(a);this._style.insertText("."+this._id+"-col-last:after{right:0}");this.pagination&&
(this.element.addClassName(e.className+"-grid-pagination"),this._pager=(new F({className:e.className+"-grid-pager",items:[{key:"rn",element:(new f("span")).insertText("-")},{key:"first",element:new q({className:e.className+"-grid-pager-first",onSelect:function(){this.pagePosition=0;this._requestRender()}.bind(this)})},{key:"prev",element:new q({className:e.className+"-grid-pager-prev",onSelect:function(){--this.pagePosition;this._requestRender()}.bind(this)})},{key:"num",element:(new f("span",{"class":e.className+
"-grid-pager-num"})).insertText("-")},{key:"next",element:new q({className:e.className+"-grid-pager-next",onSelect:function(){++this.pagePosition;this._requestRender()}.bind(this)})},{key:"last",element:new q({className:e.className+"-grid-pager-last",onSelect:function(){this.pagePosition=Math.floor(this.rows.length/this.numberOfRowsPerPage);this._requestRender()}.bind(this)})}]})).insertTo(this.element));this.fill?(this.element.addClassName(e.className+"-grid-fill"),this._body.onscroll=this._createBodyOnScrollHandler(this)):
this.element.onscroll=this._createOnScrollHandler(this);return this},_requestRender:function(){this._renderTimer&&clearTimeout(this._renderTimer);this._renderTimer=setTimeout(this._render.bind(this),0);return this},_render:function(){if(null!==this.onRender&&!1===this.onRender(this))return this;var a=!1===this.disableCheckbox&&!1===this.disableSelect&&!0===this.multiSelect,b,c,d,h,k,m,l,g,n,p=this.rows.length,q=this.cols.length;this.pagination&&(m=0,l=Math.ceil(p/this.numberOfRowsPerPage),l<=this.pagePosition&&
(this.pagePosition=l-1),0>=this.pagePosition&&(this.pagePosition=0),g=this.pagePosition*this.numberOfRowsPerPage,n=g+this.numberOfRowsPerPage);this._tbody.update();for(b=0;b<p;b++){if(this.pagination){if(b<g)continue;if(b>=n)break;++m}d=this.rows[b];d._tr||(d._tr=new f("tr"));d._tr.insertTo(this._tbody);d.id&&d._tr.writeAttribute("id",d.id);d.className&&d._tr.writeAttribute("class",d.className);d.attribute&&d._tr.writeAttribute(d.attribute);d.style&&d._tr.setStyle(d.style);if(d.onClick||this.onClick||
!1===this.disableSelect)!1===this.disableSelect&&d._tr.addClassName(e.className+"-grid-row-selectable"),(d.onClick||this.onClick)&&d._tr.addClassName(e.className+"-grid-row-clickable"),d._tr.onclick=this._createRowOnClickHandler(this,d);if(d.onDblClick||this.onDblClick)d._tr.ondblclick=this._createRowOnDblClickHandler(this,d);a&&!d._checkbox&&(d._checkbox=(new v({onChange:this._createRowOnCheckHandler(this,d)})).insertTo((new f("td",{"class":e.className+"-grid-cell-checkbox"})).insertTo(d._tr)));
!0===d.isSelected&&this.select(d);for(c=0;c<q;c++)h=this.cols[c],k=void 0===d.cell[h.key]?d.cell[h.key]={}:d.cell[h.key],"string"===typeof k&&(k=d.cell[h.key]={text:k}),k._td||(k._td=new f("td")),k._td.insertTo(d._tr),k.id&&k._td.writeAttribute("id",k.id),k.className&&k._td.writeAttribute("class",k.className),k.attribute&&k._td.writeAttribute(k.attribute),k.style&&k._td.setStyle(k.style),h.align&&(k._td.style.textAlign=h.align),k._td.addClassName(h._id),k._div||(k._div=new f),k._div.insertTo(k._td),
k.text&&k._div.updateText(k.text),k.html&&k._div.update(k.html),k.element&&k._div.update(k.element),k.icon&&(k._div.addClassName(e.className+"-icon"),k._div.setStyle({backgroundImage:"url("+k.icon+")"})),k.onClick&&(k._td.addClassName(e.className+"-grid-cell-clickable"),k._td.onclick=this._createCellOnClickHandler(this,k)),k.onDblClick&&(k._td.ondblclick=this._createCellOnDblClickHandler(this,k)),k.postProcess&&k.postProcess(k._td);d._last||(d._last=new f("td",{"class":this._id+"-col-last"}));d._last.insertTo(d._tr);
d.menuItems&&(d._last.addClassName(e.className+"-grid-cell-menu"),d._menu&&d._menu.remove(),d._menu=new E({target:d._tr,items:d.menuItems}),d._last.onclick=this._createLastRowOnClickHandler(this,d));d.postProcess&&d.postProcess(d._tr);this.postProcessOfRow&&this.postProcessOfRow(d._tr)}this.pagination&&(this._pager.getElementByKey("rn").updateText(g+1+" - "+(g+m)+" / "+p),this._pager.getElementByKey("num").updateText(this.pagePosition+1+" / "+l));!1===this.disableResize&&(this.fill&&(this._head.style.right=
this._body.offsetWidth-this._body.clientWidth+"px",this._head.scrollLeft=this._body.scrollLeft),this._updateLayoutOfCols(),this._updatePositionOfResizeHandles());if(null!==this.onRendered)this.onRendered(this);return this},_updatePositionOfResizeHandles:function(){var a=this.fill?-this._body.scrollLeft:0,b,c,d;c=0;for(d=this.cols.length;c<d;c++)b=this.cols[c],b._resizeHandle&&(b._resizeHandle.style.left=b._th.offsetLeft+b._th.getWidth()+a+"px");return this},_updateLayoutOfCols:function(){var a,b,
c;b=0;for(c=this.cols.length;b<c;b++)a=this.cols[b],a.width||(a.width=a._th.getWidth(),this._style.updateText(this._style.innerHTML.replace(new RegExp("("+a._id+"{width:)([^}]*)}"),"$1"+a.width+"px}")));this.element.addClassName(e.className+"-grid-fixed");setTimeout(function(){var a=this.fill?this._body:this.element;this._style.updateText(this._style.innerHTML.replace(new RegExp("("+this._id+"-col-last:after{right:)([^}]*)}"),"$1"+(a.scrollWidth-a.clientWidth-a.scrollLeft)+"px!important}"))}.bind(this),
0);return this},_createOnScrollHandler:function(a){return function(b){!1===a.disableResize&&a._updateLayoutOfCols()}},_createBodyOnScrollHandler:function(a){return function(b){a._head.style.right=a._body.offsetWidth-a._body.clientWidth+"px";a._head.scrollLeft=a._body.scrollLeft;!1===a.disableResize&&(a._updateLayoutOfCols(),a._updatePositionOfResizeHandles())}},_createColOnClickHandler:function(a,b){return function(c){a.sort(b.key,!b.isAsc)}},_createRowOnClickHandler:function(a,b){return function(c){if(!1!==
a.isEnabled()){if(b.onClick)b.onClick(c,b);if(a.onClick)a.onClick(c,b);!1===a.disableSelect&&(!0===b.isSelected?a.deselect(b):a.select(b));b._checkbox&&b._checkbox.focus();return!1}}},_createRowOnDblClickHandler:function(a,b){return function(c){if(!1!==a.isEnabled()){if(b.onDblClick)b.onDblClick(c,b);if(a.onDblClick)a.onDblClick(c,b)}}},_createCellOnClickHandler:function(a,b){return function(c){if(!1!==a.isEnabled()&&b.onClick)b.onClick(c,b)}},_createCellOnDblClickHandler:function(a,b){return function(c){if(!1!==
a.isEnabled()&&b.onDblClick)b.onDblClick(c,b)}},_createRowOnCheckHandler:function(a,b){return function(c){!1===a.isEnabled()?!0===c.targetCheckbox.isChecked()?c.targetCheckbox.uncheck():c.targetCheckbox.check():!1===a.disableSelect&&(!0===this.isChecked()?a.select(b):a.deselect(b))}},_createLastRowOnClickHandler:function(a,b){return function(c){!1!==a.isEnabled()&&(c.stopPropagation(),b._menu&&b._menu.open(c))}},_createResizeHandleOnMousedownHandler:function(a,b){return function(c){c.preventDefault();
var d=c.clientX,e=d,f=function(a){a.preventDefault();a=a.clientX-d;d+=a;b._resizeHandle.style.left=parseInt(b._resizeHandle.style.left.replace("px",""),10)+a+"px"},g=function(c){c.preventDefault();document.removeEventListener("mousemove",f,!0);document.removeEventListener("mouseup",g,!0);c=c.clientX-e;c=b._th.getWidth()+c;c=b.width=0>c?0:c;a._style.updateText(a._style.innerHTML.replace(new RegExp("("+b._id+"{width:)([^}]*)}"),"$1"+c+"px}"));a._updateLayoutOfCols();a._updatePositionOfResizeHandles()};
document.addEventListener("mousemove",f,!0);document.addEventListener("mouseup",g,!0)}}};var g=e.Form=function(a){a=a||{};this.id=a.id||null;this.className=a.className||null;this.attribute=a.attribute||null;this.style=a.style||null;this.nolabel=a.nolabel||!1;this.vertical=a.vertical||!1;this.fields=[];this._create();a.fields&&0!==a.fields.length&&this.push(a.fields);return this};e.createForm=function(a){return new g(a)};g.idCounter=0;g.prototype={insertTo:function(a,b){return this.element.insertTo(a,
b)&&this},getResult:function(){var a={},b,c,d;b=0;for(c=this.fields.length;b<c;b++)d=this.fields[b],!d.key&&"string"!==typeof d.pointer||!0!==d._dependsIsOk||null!==d.pointer&&("string"===typeof d.pointer?u.set(a,d.pointer,d.getVal()):d.key&&(a[d.key]=d.getVal()));return a},validate:function(a){var b,c,d,e=[],f;b=0;for(c=this.fields.length;b<c;b++)d=this.fields[b],!0===d._dependsIsOk&&d.input&&d.input._type&&e.push(d);var g=!1,l=function(a){!1===a&&(g=!0);f()};f=function(){0===e.length?a&&a(!g):e.shift().validate(l)};
f();return this},enable:function(){var a,b,c;a=0;for(b=this.fields.length;a<b;a++)c=this.fields[a],c.input&&c.input._type&&c.input._type.enable.call(c.input);return this},disable:function(){var a,b,c;a=0;for(b=this.fields.length;a<b;a++)c=this.fields[a],c.input&&c.input._type&&c.input._type.disable.call(c.input);return this},getField:function(a){var b,c,d;b=0;for(c=this.fields.length;b<c;b++)if(d=this.fields[b],d.key&&d.key===a)return d;return null},push:function(a){var b,c;if(a instanceof Array)for(b=
0,c=a.length;b<c;b++)this._createField(a[b]),this.fields.push(a[b]);else this._createField(a),this.fields.push(a);b=0;for(c=this.fields.length;b<c;b++)this._collectFieldRefs(this.fields[b]),this._checkFieldDepends(this.fields[b]);this._requestRender();return this.fields.length},splice:function(a,b,c){var d;b="undefined"===typeof b?this.fields.length-a:b;var e=this.fields.splice(a,b);b=0;for(d=e.length;b<d;b++)e[b]._div&&(e[b]._div.remove(),delete e[b]._div);if(c)for(!1===c instanceof Array&&(c=[c]),
b=0,d=c.length;b<d;b++)this._createField(c[b]),this.fields.splice(a+b,0,c[b]);b=0;for(d=this.fields.length;b<d;b++)this._collectFieldRefs(this.fields[b]),this._checkFieldDepends(this.fields[b]);this._requestRender();return e},removeField:function(a){var b=[];!1===a instanceof Array&&(a=[a]);var c,d;c=0;for(d=a.length;c<d;c++){var e="number"===typeof a[c]?a[c]:this.indexOf(a[c]);-1!==e&&b.push(this.splice(e,1))}return b[0]},indexOf:function(a){if("string"===typeof a){var b=-1,c,d;c=0;for(d=this.fields.length;c<
d;c++)if(this.fields[c].key===a){b=c;break}return b}return this.fields.indexOf(a)},_create:function(){this.element=new f("form");this.id&&this.element.writeAttribute("id",this.id);this.className&&this.element.writeAttribute("class",this.className);this.attribute&&this.element.writeAttribute(this.attribute);this.style&&this.element.setStyle(this.style);this.element.addClassName(e.className+" "+e.className+"-form");!0===this.nolabel&&this.element.addClassName(e.className+"-form-nolabel");!0===this.vertical&&
this.element.addClassName(e.className+"-form-vertical");this.element.on("submit",function(a){a.preventDefault()});return this},_requestRender:function(){this._renderTimer&&clearTimeout(this._renderTimer);this._renderTimer=setTimeout(this._render.bind(this),0);return this},_render:function(){var a=document.activeElement||{},b,c,d;b=0;for(c=this.fields.length;b<c;b++)d=this.fields[b],!0===d._dependsIsOk?d._div.insertTo(this.element):!0===d.visible()&&d._div.remove();a&&(!0===/Trident/.test(window.navigator.userAgent)?
setTimeout(function(){a.focus();if("INPUT"===a.tagName&&("text"===a.type||"password"===a.type||"number"===a.type)||"TEXTAREA"===a.tagName)if("number"===typeof a.selectionStart)a.selectionStart=a.selectionEnd=a.value.length;else if("undefined"!==typeof a.createTextRange){var b=a.createTextRange();b.collapse(!1);b.select()}},0):a.focus());return this},_collectFieldRefs:function(a){a._refs=[];"undefined"!==typeof a.point&&(a.pointer=a.point,delete a.point);if(!a.key&&"string"!==typeof a.pointer)return this;
var b,c,d,e,f,g,l;b=0;for(c=this.fields.length;b<c;b++)if(g=this.fields[b],a!==g&&g.depends&&0!==g.depends.length)for(d=0,e=g.depends.length;d<e;d++)if(g.depends[d]instanceof Array){l=!1;e=0;for(f=g.depends[d].length;e<f;e++){if(g.depends[d][e].key===a.key){l=!0;break}"string"===typeof g.depends[d][e].point&&(g.depends[d][e].pointer=g.depends[d][e].point,delete g.depends[d][e].point);if("string"===typeof g.depends[d][e].pointer){if(g.depends[d][e].pointer===a.pointer){l=!0;break}if(g.depends[d][e].pointer===
"/"+a.key){l=!0;break}}}l&&a._refs.push(g);break}else{if(g.depends[d].key===a.key){a._refs.push(g);break}"string"===typeof g.depends[d].point&&(g.depends[d].pointer=g.depends[d].point,delete g.depends[d].point);if("string"===typeof g.depends[d].pointer){if(g.depends[d].pointer===a.pointer){a._refs.push(g);break}if(g.depends[d].pointer==="/"+a.key){a._refs.push(g);break}}}return this},_compareDepend:function(a){var b;if(a.key){var c=this.getField(a.key);if(null!==c){if(!a.op&&!a.tester&&void 0===a.val)return!0;
!0===c._dependsIsOk&&(b=c.getVal())}}else if("string"===typeof a.pointer)try{b=u.get(this.getResult(),a.pointer)}catch(d){}else return!0;if("function"===typeof a.tester)return!!a.tester(b,a);if(a.op){if("==="===a.op&&a.val===b||"!=="===a.op&&a.val!==b||">="===a.op&&a.val>=b||"<="===a.op&&a.val<=b||">"===a.op&&a.val>b||"<"===a.op&&a.val<b||"in"===a.op&&"undefined"!==typeof b[a.val])return!0}else if(a.val===b)return!0;return!1},_checkFieldDepends:function(a){var b=a.depends;if(!b||0===b.length)return a._dependsIsOk=
!0;var c=!0,d,e,f,g,l,r;d=0;for(e=b.length;d<e;d++)if(l=b[d],l instanceof Array){r=!1;f=0;for(g=l.length;f<g;f++)if(!0===this._compareDepend(l[f])){r=!0;break}if(!1===r){c=!1;break}}else if(!1===this._compareDepend(l)){c=!1;break}return a._dependsIsOk=c},_createField:function(a){a._dependsIsOk=!a.depends||0===a.depends.length;a._div=new f("div");a.id&&a._div.writeAttribute("id",a.id);a.className&&a._div.writeAttribute("class",a.className);a.attribute&&a._div.writeAttribute(a.attribute);a.style&&a._div.setStyle(a.style);
!1===this.nolabel&&(a._label=(new f("label")).insertText(a.label||""),(new f("div",{"class":e.className+"-form-field-label"})).insert(a._label).insertTo(a._div),a.icon&&(a._label.addClassName(e.className+"-icon"),a._label.setStyle({backgroundImage:"url("+a.icon+")"})));a._inputC=(new f("div")).insertTo(a._div);a.input&&a.input.type&&(a.input._type="string"===typeof a.input.type?g.inputType[a.input.type]:a.input.type);a.input&&a.input._type&&(a.input.id||(a.input.id=e.className+"-form-input-"+ ++g.idCounter),
!1===this.nolabel&&a._label.writeAttribute("for",a.input.id),a.input.element=a.input._type.create.call(a.input),(new f("div",{"class":e.className+"-form-field-input"})).insert(a.input.element).insertTo(a._inputC),a.input.element.writeAttribute("id",a.input.id),a.input.value?a.input.val=a.input.value:a.input.values&&(a.input.val=a.input.values),void 0!==a.input.val&&a.input._type.setVal.call(a.input,a.input.val),a.input.style&&a.input.element.setStyle(a.input.style),a.input.validators?a.input.validators.forEach(function(b,
c){"string"===typeof b&&(a.input.validators[c]=e.Form.inputValidator[b])}):a.input.validators=[],a.input._result=(new f("ul",{"class":e.className+"-form-field-result"})).insertTo(a._inputC),!0===a.input.isRequired&&a._div.addClassName(e.className+"-required"));a.element&&(new f("div",{"class":e.className+"-form-field-element"})).insert(a.element).insertTo(a._inputC);a.html&&(new f("div",{"class":e.className+"-form-field-html"})).insert(a.html).insertTo(a._inputC);a.text&&(new f("p",{"class":e.className+
"-form-field-text"})).insertText(a.text).insertTo(a._inputC);a.visible=function(){return null!==a._div.parentNode&&a._div.parentNode===this.element}.bind(this);a.getVal=function(){if(a.input){var b=a.input._type.getVal.call(a.input);!0===a.input.toString&&(b=b.toString());!0===a.input.trim&&"string"===typeof b&&(b=b.trim());!0===a.input.toNumber&&"number"!==typeof b&&("string"===typeof b?b=parseFloat(b):b instanceof Date?b=b.getTime():"boolean"===typeof b&&(b=!0===b?1:0));"function"===typeof a.input.transform&&
(b=a.input.transform.call(a.input,b));return b}};a.setVal=function(b){if(!a.input)return a;a.input._type.setVal.call(a.input,b);a._inputOnChange();return a};a.validate=function(b){var c=a.getVal(),d=!1,h=!1;a.input._result.update();!0===a.input.isRequired&&(void 0===c?d=!0:!1===c||null===c?d=!0:"number"===typeof c&&!0===isNaN(c)?d=!0:void 0!==c.length&&0===c.length&&(d=!0));a.input.min&&("number"===typeof c?a.input.min>c&&(d=!0):"string"===typeof c&&""!==c?a.input.min>parseInt(c,10)&&(d=!0):c instanceof
Array&&a.input.min>c.length&&(d=!0));a.input.max&&("number"===typeof c?a.input.max<c&&(d=!0):"string"===typeof c&&""!==c?a.input.max<parseInt(c,10)&&(d=!0):c instanceof Array&&a.input.max<c.length&&(d=!0));a.input.minLength&&a.input.minLength>(c.length||c.toString&&c.toString().length||0)&&"string"===typeof c&&""!==c&&(d=!0);a.input.maxLength&&a.input.maxLength<(c.length||c.toString&&c.toString().length||0)&&(d=!0);var g=[];a.input.validators.forEach(function(a){g.push(a)});var m,l=function(b,c){switch(b){case null:case "warning":h=
!0;break;case !1:case "error":d=!0}c&&(new f("li")).insertText(c).insertTo(a.input._result);m()};m=function(){if(0===g.length||!0===d)""===a.input._result.innerHTML?a._div.removeClassName(e.className+"-has-result"):a._div.addClassName(e.className+"-has-result"),d?(a._div.removeClassName(e.className+"-has-warning"),a._div.removeClassName(e.className+"-has-success"),a._div.addClassName(e.className+"-has-error")):h?(a._div.removeClassName(e.className+"-has-error"),a._div.removeClassName(e.className+
"-has-success"),a._div.addClassName(e.className+"-has-warning")):(a._div.removeClassName(e.className+"-has-error"),a._div.removeClassName(e.className+"-has-warning"),a._div.addClassName(e.className+"-has-success")),a._hasError=d,a._hasWarning=h,b&&b(!d);else{var f=g.shift();"function"===typeof f?f.call(a.input,c,l):"string"===typeof c&&""!==c?f.regexp.test(c)?l(!0,f.success):l(!1,f.error):l(!0)}};m()};a._checkRefs=function(){var b=!1,c,d,e;c=0;for(d=a._refs.length;c<d;c++)e=a._refs[c],e._dependsIsOk!==
this._checkFieldDepends(e)&&(e._checkRefs(),b=!0);!0===b&&this._requestRender()}.bind(this);a._inputOnChange=function(){a.validate();a._checkRefs()};a.input&&a.input._type&&(a.input._type.changeEvents||["change"]).forEach(function(b){a.input.element.on(b,a._inputOnChange)});return this}};g.inputValidator={numeric:{regexp:/^[0-9]+$/},alphanumeric:{regexp:/^[a-z0-9]+$/i}};g.inputType={};g.inputType.text={changeEvents:["change","keyup"],create:function(){return new w({placeholder:this.placeholder,icon:this.icon,
attribute:{maxlength:this.maxLength}})},getVal:function(){return this.element.getValue()},setVal:function(a){this.element.setValue(a)},enable:function(){this.element.enable()},disable:function(){this.element.disable()}};g.inputType.password={changeEvents:["change","keyup"],create:function(){return new w({placeholder:this.placeholder,icon:this.icon,attribute:{type:"password",maxlength:this.maxLength}})},getVal:g.inputType.text.getVal,setVal:g.inputType.text.setVal,enable:g.inputType.text.enable,disable:g.inputType.text.disable};
g.inputType.textarea={changeEvents:["change","keyup"],create:function(){return new G({placeholder:this.placeholder,icon:this.icon,attribute:{maxlength:this.maxLength}})},getVal:g.inputType.text.getVal,setVal:g.inputType.text.setVal,enable:g.inputType.text.enable,disable:g.inputType.text.disable};g.inputType.number={changeEvents:["change","keyup"],create:function(){return new w({placeholder:this.placeholder,icon:this.icon,attribute:{type:"number",inputmode:"numeric",min:this.min,max:this.max,maxlength:this.maxLength}})},
getVal:function(){return parseFloat(this.element.getValue())},setVal:g.inputType.text.setVal,enable:g.inputType.text.enable,disable:g.inputType.text.disable};g.inputType.combobox={changeEvents:["change","keyup"],create:function(){return new I({placeholder:this.placeholder,icon:this.icon,items:this.items,attribute:{maxlength:this.maxLength}})},getVal:g.inputType.text.getVal,setVal:g.inputType.text.setVal,enable:g.inputType.text.enable,disable:g.inputType.text.disable};g.inputType.checkbox={create:function(){return new v({icon:this.icon,
label:this.label})},getVal:function(){return this.element.isChecked()},setVal:function(a){a?this.element.check():this.element.uncheck()},enable:g.inputType.text.enable,disable:g.inputType.text.disable};g.inputType.checkboxes={create:function(){return new J({items:this.items})},getVal:function(){return this.element.getValues()},setVal:function(a){this.element.setValues(a)},enable:g.inputType.text.enable,disable:g.inputType.text.disable};g.inputType["switch"]={create:function(){return new K},getVal:function(){return this.element.isOn()},
setVal:function(a){a?this.element.switchOn():this.element.switchOff()},enable:g.inputType.text.enable,disable:g.inputType.text.disable};g.inputType.radios={create:function(){return new C({items:this.items})},getVal:g.inputType.text.getVal,setVal:g.inputType.text.setVal,enable:g.inputType.text.enable,disable:g.inputType.text.disable};g.inputType.select={create:function(){return new H({items:this.items,listView:this.listView,multiple:this.multiple,max:this.max,selectedIndex:this.selectedIndex,selectedIndexes:this.selectedIndexes})},
getVal:function(){return!0===this.element.multiple?this.element.getValues():this.element.getValue()},setVal:function(a){!1===this.element.multiple?a=[a]:this.element.deselectAll();var b,c,d,e;b=0;d=a.length;for(e=this.element.items.length;b<d;b++)for(c=0;c<e;c++)if(a[b]===this.element.items[c].value){this.element.select(c);break}},enable:g.inputType.text.enable,disable:g.inputType.text.disable};g.inputType.file={create:function(){return new f("input",{type:"file"})},getVal:function(){return this.element.files[0]},
setVal:function(a){this.element.files[0]=a},enable:function(){this.element.writeAttribute("disabled",!1)},disable:function(){this.element.writeAttribute("disabled",!0)}};g.inputType.files={create:function(){return new f("input",{type:"file",multiple:!0})},getVal:function(){return this.element.files},setVal:function(a){this.element.files=a},enable:function(){this.element.writeAttribute("disabled",!1)},disable:function(){this.element.writeAttribute("disabled",!0)}}})();
